# Subs-bot - Проект документация

## Обзор проекта
Subs-bot - это Telegram бот для автоматической суммаризации видео и аудио контента с использованием различных AI моделей.

## Архитектура

### Основные компоненты

#### 1. Telegram Bot (bot.py)
- Основной интерфейс пользователя
- Обработка команд и сообщений
- Интеграция с суммаризатором и транскрайбером

#### 2. Text Summarizer (summarizer.py)
- Автоматический выбор модели суммаризации
- Обработка текста по частям
- Перевод на русский язык
- Логирование всех операций

#### 3. Voice Transcriber (voice_transcriber.py)
- Транскрипция голосовых сообщений
- Поддержка различных аудио форматов

#### 4. Mind Map Generator (mind_map_generator.py) - ИНТЕГРИРОВАН
- ✅ Анализ и структурирование текста с помощью OpenRouter LLMs
- ✅ RAG/chunk-based обработка длинных текстов
- ✅ Генерация Markdown для Markmap с эмодзи и метаданными
- ✅ Создание Mermaid диаграмм с улучшенной визуализацией
- ✅ Рендеринг PNG через mermaid-cli или kroki.io API
- ✅ Генерация интерактивных HTML карт с Markmap
- ✅ Автоматическое построение иерархии идей 2-3 уровня
- ✅ **ИНТЕГРАЦИЯ С TELEGRAM БОТОМ** - Полностью интегрирован

### Система знакомства нового пользователя

#### Приветственное сообщение
- Простое и понятное описание возможностей
- Кнопка "Узнать подробнее" для детальной информации
- Кнопка "Быстрая помощь" для решения проблем
- Команда `/first_time` для пошагового обучения

#### Адаптивный интерфейс
- Отслеживание новых пользователей
- Дополнительные подсказки для новичков
- Постепенное знакомство с функциями
- Понятные сообщения об ошибках с подсказками

#### Навигация
- Главная клавиатура с логичным расположением кнопок
- Быстрый доступ к основным функциям
- Контекстная помощь при ошибках
- Возможность начать заново в любой момент

### Система суммаризации

#### Автоматический выбор модели
- Бот автоматически выбирает доступную модель без запроса у пользователя
- Список бесплатных моделей OpenRouter API
- Случайный выбор для распределения нагрузки

#### Процесс суммаризации
1. Автоматический выбор модели
2. Суммаризация текста
3. Запрос удовлетворенности результатом
4. При необходимости - повторная попытка с другой моделью

#### Форматированные суммаризации (Markdown)
- Используется Markdown-форматирование для читабельности
- Абзацы разделяются пустой строкой для удобного скроллинга в Telegram
- Ключевые понятия выделяются жирным, списки маркируются
- Допускаются уместные эмодзи в заголовках/маркерах для лучшей навигации
- Отправка осуществляется с `parse_mode='Markdown'`

#### Логирование
- Отдельный лог для событий суммаризации (`logs/summarization.log`)
- Детальная информация о каждой операции
- Статистика использования моделей

### Система Mind Map (НОВАЯ ФУНКЦИОНАЛЬНОСТЬ)

#### Анализ текста и структурирование
- RAG / chunk-based обработка длинных текстов
- Использование OpenRouter LLMs для выделения идей
- Построение иерархии 2-3 уровня
- Формирование дерева идей в JSON формате

#### Генерация визуализаций
- Markdown файлы для Markmap
- Mermaid диаграммы для статичных изображений
- PNG/PDF экспорт через mermaid-cli
- Интерактивные HTML карты

#### Интеграция с ботом
- Кнопка "Построить карту памяти" после суммаризации
- Отправка различных форматов карт
- Обработка ошибок и уведомления

### Технологический стек
- Python 3.8+
- python-telegram-bot
- OpenRouter API для AI моделей
- Soniox API для транскрипции
- asyncio для асинхронности
- mermaid-cli для рендеринга диаграмм
- markmap-lib для интерактивных карт

## Структура проекта
```
Subs-bot/
├── bot.py                 # Основной бот
├── summarizer.py          # Модуль суммаризации
├── voice_transcriber.py   # Модуль транскрипции
├── mind_map_generator.py  # Модуль генерации mind map
├── docs/                  # Документация (организована согласно .cursorrules)
│   ├── Project.md         # Архитектура проекта
│   ├── Tasks.md           # Текущие задачи и статусы
│   ├── Diary.md           # Дневник разработки
│   ├── changelog.md       # Хронологический журнал изменений
│   ├── tasktracker.md     # Детальное отслеживание задач
│   ├── README.md          # Структура документации
│   ├── USER_GUIDE.md      # Руководство пользователя
│   ├── MIND_MAP_README.md # Документация Mind Map
│   └── ...                # Другие специализированные документы
├── logs/                  # Логи
├── tests/                 # Тесты
├── research/              # Исследовательские файлы
├── setup_files/           # Файлы настройки
├── reports/               # Отчеты
└── requirements.txt       # Зависимости
```

## Принципы разработки
- SOLID принципы
- KISS (Keep It Simple, Stupid)
- DRY (Don't Repeat Yourself)
- Асинхронность через async/await
- Валидация входных данных
- Обработка ошибок

## Процесс разработки (согласно .cursorrules)

### Обязательные шаги при изменениях:
1. **Обновить документацию** - сначала `/docs/Project.md` и `/docs/Tasks.md`
2. **Внести изменения в код** - только после обновления документации
3. **Добавить запись в дневник** - `/docs/Diary.md` с датой и описанием
4. **Обновить changelog** - `/docs/changelog.md` с хронологией изменений
5. **Отслеживать задачи** - `/docs/tasktracker.md` с детальным прогрессом

### Структура документации:
- **Project.md** - архитектура, компоненты, диаграммы Mermaid
- **Tasks.md** - статусы, приоритеты, новые задачи
- **Diary.md** - решения, проблемы, технические детали
- **changelog.md** - хронологический журнал всех изменений
- **tasktracker.md** - детальное отслеживание выполнения задач

### Стандарты кодирования:
- Единый стиль кодирования (линтеры, форматтеры, pre-commit)
- Документирование каждого файла с заголовком
- Code review для всех изменений
- Удаление неиспользуемого кода и комментариев
